<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <title>Informações da Bateria</title>
</head>
<body class="w-full h-dvh bg-gray-900 px-6">
<span class="loading loading-dots loading-xl bg-white fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2" id="loading"></span>
<section class="hidden">
  <h2 class="text-white mb-2 pt-4">Bateria</h2>
  <div>
    <div class="card bg-base-100 shadow-sm rounded">
      <div class="card-body">
        <div class="flex justify-between w-full">
          <h2>Status da Bateria</h2>
        </div>
        <progress class="progress" id="progress" value="0" min="0" max="100"></progress>
        <div class="flex">
          <p id="batteryPercent">%</p>
          <div class="flex gap-2 items-center">
            <span id="statusColor" class="h-2 w-2 rounded-full block"></span>
            <p id="batteryStatus"></p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<section class="mt-6 hidden">
  <h2 class="text-white">Configurar notificação</h2>
  <p class="text-sm text-gray-400 mb-2">Nível da bateria</p>
  <div class="flex gap-2">
    <input type="number" placeholder="Porcentagem da bateria" value="20" min="5" max="100" class="input [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none" id="batteryThreshold"/>
    <button id="saveThreshold" class="btn btn-primary">Salvar</button>
  </div>
  <div>
    <span id="message" class="text-xs"></span>
  </div>
</section>
  <script>
    window.electronAPI.onBatteryInfo((_event, data) => {
      const sectionElements = document.querySelectorAll('section')
      const loading = document.getElementById('loading')
      document.getElementById('batteryPercent').textContent = `${data.percent}%`
      const progress = document.getElementById('progress')
      progress.value = data.percent
      const batteryStatusElement = document.getElementById('batteryStatus')
      const statusElement = document.getElementById('statusColor')
      if(data){
        sectionElements.forEach(section => {
          section.classList.remove('hidden')
        })
        loading.classList.add('hidden')
      }
      if (data.isCharging) {
        batteryStatusElement.textContent = 'Conectado ao carregador'
        if(data.percent > 20 && data.percent < 80){
          progress.classList.add('text-orange-500')
          statusElement.classList.add('bg-orange-500')
        }
      }

      if (data.percent === 100) {
        batteryStatusElement.textContent = 'Carregado'
        progress.classList.add('text-green-500')
        statusElement.classList.add('bg-green-500')
      }else if (data.percent >= 80) {
        progress.classList.add('text-green-500')
        statusElement.classList.add('bg-green-500')
      } else if(data.percent < 20) {
        progress.classList.add('text-red-500')
        statusElement.classList.add('bg-red-500')
        batteryStatusElement.textContent = 'Descarregando'
      }

      if (!data.isCharging) {
        batteryStatusElement.textContent = 'Descarregando'
      }
    })

    window.electronAPI.onPlatformInfo((platform) => {
      document.getElementById('platform').textContent = platform
    })
    function clearMessage(className){
      setTimeout(() => {
        message.textContent = '';
        message.classList.remove(className);
      },3000)
    }
    document.getElementById('saveThreshold').addEventListener('click', (event) => {
      let value = parseInt(document.getElementById('batteryThreshold').value,10)
      const message = document.getElementById('message');
      if(value < 5){
        message.classList.add('text-red-500');
        message.textContent = 'Valor minimo de 5%';
        clearMessage('text-red-500');
       return
      }
      message.classList.add('text-green-500');
      message.textContent = `Valor ajustado para ${value}%`;
      window.electronAPI.updateBatteryThreshold(value)
      clearMessage('text-green-500');
    })
  </script>
</body>
</html>
